# 汎用Kaggle用・自己完結型・訓練パイプライン作成ガイドライン

## 【あなたの役割】

あなたは、私のための専属**フレームワーク・アーキテクト**です。あなたの任務は、私のリポジトリにある現在の`train.py`（あるいは`.ipynb`）を、私が定義する「8つの論理ブロック」を完全に満たす、**最終的にKaggle Notebook上で単一ファイルとして実行可能**な、構造化された訓練パイプラインへと、全面的にリファクタリングしてください。

## 【最重要ルール：不明点の確認義務】

このガイドラインを実装するにあたり、ベースコードの意図や、私の要求に少しでも曖昧な点があれば、決して推測で作業を進めてはいけません。必ず、作業を中断し、私に具体的な確認質問を行ってください。(例：「`Config`クラスに`DEBUG`モードを追加しますが、`DEBUG=True`の時は、訓練データを最初の1000行にサンプリングする仕様でよろしいですか？」)

## 【分析対象】

- **ベースコード:** リポジトリのルートにある`train.py`（あるいは`.ipynb`）の最新版。
- **設計思想:** このプロンプトで定義される、8つの論理ブロック。

---

## 【パイプラインに搭載すべき8つの論理ブロック】

最終的に生成する単一のPythonスクリプト (`train_kaggle.py`) は、以下の**8つの明確に分離された「論理ブロック」**で構成されていなければなりません。各ブロックの先頭には、`# === 1. Configuration ===` のような、明確なコメントヘッダーを付けてください。

### **1. 📝 設定ブロック (Configuration Block)**

- **要件:**
    - 実験に関する全てのパラメータを、単一の`Config`クラスで一元管理してください。
    - **【環境自動適応】** この`Config`クラスには、**実行環境（Kaggle or Codespaces）を自動で検知**し、`INPUT_DIR`や`DEBUG`フラグを動的に切り替えるロジックを必ず含めてください。
        - **Kaggle環境の場合:** フルデータパス (`/kaggle/input/...`) を使用し、`DEBUG=False`とします。
        - **Codespaces/ローカル環境の場合:** ローカルパス (`./`) を使用し、`DEBUG=True`とします。

### **2. ⏱️ ロギングブロック (Logging Block)**

- **要件:** 実験の進捗を記録するための、シンプルな`Logger`クラス、または関数群を定義してください。ログはコンソールとテキストファイルの両方に出力されるようにしてください。

### **3. 🔧 特徴量エンジニアリングブロック (Feature Engineering Block)**

- **要件:** 特徴量作成ロジックを、独立した`create_features(dataframe, config)`関数にまとめてください。

### **4. 🤖 モデル定義ブロック (Model Definition Block)**

- **要件:** モデルのアーキテクチャを定義する`build_model(config)`関数を定義してください。

### **5. 🎓 学習・評価関数ブロック (Training & Evaluation Functions Block)**

- **要件:**
    - CVの1 Fold分を学習・評価する`train_fold`関数を定義してください。
    - 最終的なスコアを計算・報告する`report_results`関数を定義してください。

### **6. 💾 成果物保存ブロック (Artifact Saving Block)**

- **要件:** 推論に必要な全てのアセットを保存する`save_artifacts`関数を定義してください。

### **7. 🔄 メイン実行ブロック (Main Pipeline Block)**

- **要件:**
    - これまで定義した全ての関数やクラスを呼び出し、データ読み込みから、CV実行、結果報告、成果物保存まで、**パイプライン全体の流れをオーケストレーション**する、メインの実行ロジックを記述してください。
    - このブロックが、スクリプトの「司令塔」となります。

### **8. 🚀 実行トリガーブロック (Execution Trigger Block)**

- **要件:** スクリプトの最後に、`if __name__ == "__main__":`ブロックを設け、そこからメインの実行ロジックを呼び出すようにしてください。

---

## 【最終的な成果物】

- 上記の**8つの論理ブロック**で美しく構造化された、**単一の、自己完結したPythonスクリプト (`train_kaggle.py`)**。
- このスクリプトは、Kaggle Notebook上で、**`!python train_kaggle.py`**と実行するだけで、エラーなく、最後まで完走するものでなければならない。
