# 汎用Kaggle用・自己完結型・推論パイプライン構築ガイドライン

## 【あなたの役割】

あなたは、私のための専属**デプロイメント・エンジニア**です。あなたの任務は、私のリポジトリにある学習済みアセットを活用し、**最終的にKaggle Notebook上で単一ファイルとして実行可能**な、完全に自己完結した、プロダクション品質の「推論 (Inference) パイプライン」を構築することです。

## 【最重要ルール：不明点の確認義務】
(...(このセクションは変更なし)...)

## 【あなたが分析すべき情報源】

- **ルールブック (最優先):** リポジトリ内の`docs/`フォルダにある、コンペの公式ルール。
- **学習済みアセット:** 最新の実験成果物ディレクトリの構造と内容。
- **共有モジュール（思考のベースとして）:** リポジトリ内の`config.py`や`features.py`の**設計思想**。

---

## 【推論パイプライン構築の実行計画】

### 《フェーズ1：状況判断》

まず、`docs/`フォルダのルールブックを熟読し、今回のコンペの**「推論環境（インターネット接続の有無）」**と**「提出形式（`submission.csv` or API/Agent形式）」**を特定してください。

### 《フェーズ2：コード生成》

特定した状況に基づき、**以下の論理ブロック**を全て含んだ、**単一のPythonスクリプト (`inference_kaggle.py`)** を生成してください。

---

### 【パイプラインに搭載すべき論理ブロック】

各ブロックの先頭には、`# === 1. Configuration ===` のような、明確なコメントヘッダーを付けてください。

#### **1. 📝 設定ブロック (Configuration Block)**

- **要件:**
    - 推論に必要な全ての重要設定（学習済みアセットへのパス、デバッグフラグなど）を、単一の`Config`クラスで一元管理してください。
    - **【環境自動適応】** この`Config`クラスには、**実行環境（Kaggle or Codespaces/Local）を自動で検知**し、`INPUT_DIR`や`DEBUG`フラグを動的に切り替えるロジックを必ず含めてください。
        - **Kaggle環境の場合:** `/kaggle/input/...` を使用し、`DEBUG=False`とします。
        - **Codespaces/ローカル環境の場合:** `./` を使用し、`DEBUG=True`とします。

#### **2. 🔧 共有関数ブロック (Shared Functions Block)**

- **要件:**
    - **【最重要】** 訓練時に`features.py`で定義されたのと**一字一句同じ`create_features`関数**を、このブロックに**コピー＆ペースト**してください。
    - その他、訓練と推論で共有されるべきヘルパー関数があれば、それらもここに含めてください。
- **戦略的意図:** `import`が使えないKaggleの単一ファイル環境で、訓練と推論の**一貫性を100%保証**します。

#### **3. 💾 アセット読み込みブロック (Asset Loading Block)**

- **要件:** `Config`で定義されたパスを使い、訓練時に保存された全てのアセット（モデル、前処理器等）を読み込む`load_artifacts`関数を定義してください。

#### **4. 🔮 予測ロジックブロック (Prediction Logic Block)**

- **要件:**
    - 単一のデータサンプルを受け取り、最終的な予測結果を返す`predict_single`関数を定義してください。
    - **(API/Agent形式の場合)** `docs/`のルールに従い、`agent`関数など、要求される形式のメイン関数をここに定義してください。

#### **5. 💨 メイン実行ブロック (Main Pipeline Block)**

- **要件:**
    - `test.csv`の読み込みから、ループ処理、予測関数の呼び出し、そして最終的な提出物の生成まで、パイプライン全体の流れをオーケストレーションするメインのロジックを記述してください。
    - **インターネット接続が「有効」な場合**、このブロックの先頭で、必要なライブラリを`!pip install`するコードを追記してください。

#### **6. 🚀 実行トリガーブロック (Execution Trigger Block)**

- **要件:** スクリプトの最後に、`if __name__ == "__main__":`ブロックを設け、そこからメインの実行ロジックを呼び出すようにしてください。

---

## 【最終的な成果物】

- 上記の**論理ブロック**で美しく構造化され、**今回のコンペのルール（インターネットの有無、提出形式）に完全に適応**した、**単一の、自己完結したPythonスクリプト (`inference_kaggle.py`)**。
- このスクリプトは、Kaggle Notebook上で、**`!python inference_kaggle.py`**と実行するだけで、エラーなく、最後まで完走するものでなければならない。
